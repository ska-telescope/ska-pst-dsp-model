function write_dada_data (file_id, data, verbose_)
  % Write data to a DADA file
  % 
  % Args:
  %   file_id (double): The DADA file's file id as generated by `fopen`
  %   data ([numeric]): The data to be written to the DADA file

  % make sure that the data characterisitcs in the header are correct
  verbose = 0;
  if exist('verbose_', 'var')
    verbose = verbose_;
  end

  size_data = size(data);
  dtype = class(data);

  bytes_per_element = 8;
  if dtype == "single"
    bytes_per_element = 4;
  elseif dtype == "uint8" || dtype == "int8"
    bytes_per_element = 1;
  end

  if verbose
    fprintf('write_dada_data: dtype=%s\n', dtype);
  end

  if ~isreal(data)
    n_pol = size_data(1);
    n_chan = size_data(2);
    n_dat = size_data(3);
    temp = zeros(2*n_pol, n_chan, n_dat, dtype);
    for i_pol=1:n_pol
      temp(2*(i_pol-1) + 1, :, :) = real(data(i_pol, :, :));
      temp(2*(i_pol-1) + 2, :, :) = imag(data(i_pol, :, :));
    end
    data = temp;
  end

  ptr1=ftell(file_id);
  fwrite(file_id, reshape(data, numel(data), 1), dtype);
  ptr2=ftell(file_id);

  if (ptr2 - ptr1) ~= numel(data) * bytes_per_element
    fprintf ('unexpected fptr bytes=%d ptr1=%d ptr2=%d diff=%d\n', ...
        numel(data)*4, ptr1, ptr2, ptr2-ptr1);
    error ('Incorrect file pointer after writing data');
  end

end
